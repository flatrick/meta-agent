stages:
  - docs

structurizr-site:
  image: ghcr.io/avisi-cloud/structurizr-site-generatr:latest
  stage: docs
  before_script:
    - command -v python3 >/dev/null 2>&1 || (echo "python3 is required for meta-agent verification scripts." >&2 && exit 1)
  script:
    - python3 ./scripts/verify-architecture.py
  artifacts:
    paths:
      - docs/architecture/site/build/site
    expire_in: 1 week
  only:
    - branches
    - merge_requests

pages:
  image: ghcr.io/avisi-cloud/structurizr-site-generatr:latest
  stage: docs
  before_script:
    - command -v python3 >/dev/null 2>&1 || (echo "python3 is required for meta-agent verification scripts." >&2 && exit 1)
  script:
    - python3 ./scripts/verify-architecture.py
    - rm -rf public
    - mkdir -p public
    - cp -R docs/architecture/site/build/site/. public/
  artifacts:
    paths:
      - public
    expire_in: 1 week
  only:
    - main
